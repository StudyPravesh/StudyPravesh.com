<script type="text/javascript">
//	Creating dynamic form action url
function OnSubmitForm(){
	var category	=	jQuery('#category').val();
	var course		=	jQuery('#course').val();
	var state		=	jQuery('#state').val();
	var city		=	jQuery('#city').val();
	var url			= 	category + '?course=' + course +'&state=' + state +'&city=' + city;
	//alert(url);
	jQuery("#filter_now").attr("action");
	jQuery("#filter_now").attr("action", '<?php echo Mage::getUrl()?>' + url);
	return true;
}
</script>

<div class="home">
  <div class="full-width">
    <div class="row p0">
      <div class="home-filter">
        <form name="filter_now" id="filter_now" method="post" onsubmit="return OnSubmitForm();">
            <select name="cat" id="category">
                <option>Browse by</option>
                <option value="schools.html">School</option>
                <option value="coaching-institutes.html">Coaching</option>
                <option value="colleges.html">College</option>
                <option value="universities.html">University</option>
            </select>
            
            <select name="course" id="course">
                <option>Select</option>
                <option value="18">Play School</option>
                <option value="19">Primary School</option>
                <option value="20">Upper Primary School</option>

                <option value="-">---</option>
                
                <option value="">Civil Services</option>
                <option value="">Engg. Institutes</option>
                <option value="">Medical Institutes</option>
                <option value="">IIT JEE Main</option>
                <option value="">Competition Classess</option>
                <option value="">Academic Coaching Institutes</option>
                <option value="">Law Institutes</option>
                
                <option value="-">---</option>
                
                <option value="science-engg">Science & Engineering</option>
                <option value="medical-nursing">Medical/Nursing</option>
                <option value="bed">B.Ed/STC</option>
                <option value="bed">PG & Management</option>
             </select>
            <?php /*?><select name="Courses">
                <option>Select Course</option>
                <option>Option 1</option>
            </select><?php */?>
            
			<?php	//	Showing states
			$attribute 	= 	Mage::getModel('eav/config')->getAttribute('catalog_product', 'state');
			$stateCollection = 	$attribute->getSource()->getAllOptions(true, true);
			//echo '<pre>';print_r($stateCollection);die;
			if (count($stateCollection) > 0){ ?>
                <select name="state" id="state" class="required-entry validate-select">
                	<option>Select State</option>
                    <?php 
						foreach($stateCollection as $state){
							if($state['label']){ ?>
                        		<option value="<?php echo $state['value'];?>"><?php echo $state['label'] ?></option>
                    	<?php }
						} 
					?>
                </select>
            <?php }else{ ?>
                <input name="state" id="state" title="" value="" class="input-text required-entry"  placeholder="State"/>
            <?php } ?>
            
            <select name="city" id="city">
              <option value="">Please select a City </option>
            </select>
            
            <script type="text/javascript">
			Event.observe($('state'), 'change', function(event) {
				var action 	= 	"<?php echo $this->getUrl('querymanager/index/getCities'); ?>";
				var stateId = 	$('state').value;
				var request = 	new Ajax.Request(action,
					{
						method: 'GET',
						parameters: {state_id: stateId},
						onComplete: function(data) {
							//alert(data.responseText);
							$('city').replace('<select id="city" name="city" class="required-entry">' + '<option value="">Please Select City</option>' + data.responseText + '</select>');
						},
						onSuccess: function (data) {
							//alert(data.response);
							/*data = $.parseJSON(data);
							alert('test');
							console.log(data[0].response);exit
							
							
							$.each(data, function(i, user) {
								$('#city').append(
									$('<option></option>').html(user.user)
								);
							});

							var items = '';
							$.each(data,function(value, name) {
								alert(value);
							   items += "<option value='"+value+"'>"+name+"</option>";
							});
							alert(items);
							console.log(items);
							$("#city").replace('<select id="city" name="city" class="required-entry">' + '<option value="">Please Select City 2</option>' + items + '</select>'); 
							*/
							
							/*data = $.parseJSON(data);
							console.log(data[0].response);
							var result	=	JSON.parse(data);*/
							
							

							//alert(data.responseText);
							//var data = jQuery.parseJSON(data);
							//data = JSON.parse( data );
							//alert(data.responseText);
							//alert(JSON.parse(data.responseText));
							//$('city').replace('<select id="city" name="city" class="required-entry">' + '<option value="">Please Select City</option>' + JSON.parse(data.responseText) + '</select>');
							//$('city').replace('<select id="city" name="city" class="required-entry">' + '<option value="">Please Select City</option>' + data[0].response + '</select>');
						},
						onFailure: ''
					}
				);
			});
			</script>
          <input type="submit" value="Filter Now" name="filter" />
        </form>
      </div>
    </div>
  </div>
  <div class="main-content full-width">
    <div class="full-width mB10">
      <div class="row p0">
        <div class="left-content">
			<div class="full-width mB10">
			  <div class="heading full-width">Featured Schools, Colleges, Institutes and Universities</div>
        	<div class="content-box full-width mB10">
				<ul class="featured product-boxes" id="featured-box">
        <?php 
		if(($_products = Mage::helper('sarah')->getProductsFromCategory('18')) && $_products->getSize()){ 	
			foreach($_products->getItems() as $_product){?>
                <li>
                    <div class="li-holder">
                        <div class="image-box full-width"><a rel="nofollow" href="<?php echo $_product->getProductUrl(); ?>"><img src="<?php echo $this->helper('catalog/image')->init($_product, 'thumbnail')->resize(450); ?>" class="img-responsive" alt="<?php echo $this->htmlEscape($_product->getName()) ?>" /></a></div>
                        <div class="detail-box full-width">
                            <div class="name"><?php echo $this->htmlEscape($_product->getName()) ?></div>
                            <div class="price-box"><?php echo $this->helper('core')->currency($_product->getPrice(),true,false) ?>
                            </div>
                            <?php /*?><a rel="nofollow" href="<?php echo $_product->getProductUrl(); ?>">
						<p class="fontsize-type1 low-margin-bottom"><?php echo  Mage::helper('core/string')->truncate($this->stripTags($_product->getShortDescription(), null, true), $length = 45, $etc = '...'); ?></p>
					</a><?php */?>
                        </div>
                    </div>
                </li>
        <?php }
		} ?>
				</ul>
				<script type="text/javascript">
				jQuery(document).ready(function(){
					jQuery('#featured-box').slick({
						arrows			: 	true,
						dots			: 	false,
						slidesToShow	: 	3,
						slidesToScroll	: 	1,
						autoplay: true,
						autoplaySpeed: 5000
					});
				});
				</script>
			  </div>
			</div>
        </div>
        <div class="right-content">
          <div class="heading full-width">News &amp; Announcements</div>
          <div class="content-box">
            <div class="full-width border-box-1px p10">
              <?php echo $this->getLayout()->createBlock('core/template')->setTemplate('aw_blog/latest.phtml')->toHtml(); ?>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="how-it-works full-width mB10 mT10">
      <div class="row p0"><img style="max-width: 100%;" alt="" src="{{skin url='images/how-it-works.jpg'}}" /></div>
    </div>
    
    <div class="full-width mT10">
      <div class="row p0">
        <div class="left-content">
        	<?php echo $this->getLayout()->createBlock('catalog/product_mostviewed')->setTemplate('catalog/product/mostviewed.phtml')->toHtml();?>
            <?php echo $this->getLayout()->createBlock('reports/product_viewed')->setTemplate('reports/product_viewed.phtml')->toHtml(); ?>
        </div>
        
        <div class="right-content">
          <?php echo $this->getLayout()->createBlock('testimonial/sidebar')->setTemplate('testimonial/sidebar/slider.phtml')->toHtml();?>
        </div>
        
      </div>
    </div>
  </div>
</div>
