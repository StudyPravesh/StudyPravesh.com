<script type="text/javascript">
//	Creating dynamic form action url
function OnSubmitForm(){
	var category	=	jQuery('#category').val();
	var course		=	jQuery('#course').val();
	var state		=	jQuery('#state').val();
	var city		=	jQuery('#city').val();
	var url			= 	category + '?course=' + course +'&state=' + state +'&city=' + city;
	//alert(url);
	jQuery("#filterFrm").attr("action");
	jQuery("#filterFrm").attr("action", '<?php echo Mage::getUrl()?>' + url);
	return true;
}
</script>

<div class="home">
  <div class="full-width">
    <div class="row p0">
      <div class="home-filter">
        <form name="filterFrm" id="filterFrm" method="post" onsubmit="return OnSubmitForm();">
            
            <select name="category" id="category" class="required-entry validate-select">
                <option>Browse by</option>
                <option value="1">School</option>
                <option value="2">Coaching</option>
                <option value="3">College</option>
                <option value="4">University</option>
            </select>
            
<script type="text/javascript">
Event.observe($('category'), 'change', function(event) {
	var action 		= 	"<?php echo $this->getUrl('querymanager/index/getCourses'); ?>";
	var categoryId 	= 	$('category').value;	
	var request 	= 	new Ajax.Request(action,
		{
			method: 'GET',
			parameters: {category_id: categoryId},
			onComplete: function(data) {
				//alert(data.responseText);
				$('course').replace('<select id="course" name="course" class="required-entry validate-select">' + '<option value="">Select Course</option>' + data.responseText + '</select>');
			},
			onSuccess: function (data) {
				
			},
			onFailure: ''
		}
	);
});
</script>
            
            <?php	//	Showing courses
			$attribute 			= 	Mage::getModel('eav/config')->getAttribute('catalog_product', 'course');
			$courseCollection 	= 	$attribute->getSource()->getAllOptions(true, true);
			//echo '<pre>';print_r($courseCollection);die;
			if (count($courseCollection) > 0){ ?>
                <select name="course" id="course" class="required-entry validate-select">
                	<option>Select Course</option>
                    <?php 
						foreach($courseCollection as $course){
							if($course['label']){ ?>
                        		<option value="<?php echo $course['value'];?>"><?php echo $course['label'] ?></option>
                    	<?php }
						} 
					?>
                </select>
            <?php }else{ ?>
                <input name="course" id="course" title="" value="" class="input-text required-entry"  placeholder="Course"/>
            <?php } ?>
            
            
			<?php	//	Showing states
			$attribute 	= 	Mage::getModel('eav/config')->getAttribute('catalog_product', 'state');
			$stateCollection = 	$attribute->getSource()->getAllOptions(true, true);
			//echo '<pre>';print_r($stateCollection);die;
			if (count($stateCollection) > 0){ ?>
                <select name="state" id="state" class="required-entry validate-select">
                	<option>Select State</option>
                    <?php 
						foreach($stateCollection as $state){
							if($state['label']){ ?>
                        		<option value="<?php echo $state['value'];?>"><?php echo $state['label'] ?></option>
                    	<?php }
						} 
					?>
                </select>
            <?php }else{ ?>
                <input name="state" id="state" title="" value="" class="input-text required-entry"  placeholder="State"/>
            <?php } ?>
            
            <select name="city" id="city">
              <option value="">Please select a City </option>
            </select>
            
            <script type="text/javascript">
			Event.observe($('state'), 'change', function(event) {
				var action 	= 	"<?php echo $this->getUrl('querymanager/index/getCities'); ?>";
				var stateId = 	$('state').value;
				var request = 	new Ajax.Request(action,
					{
						method: 'GET',
						parameters: {state_id: stateId},
						onComplete: function(data) {
							//alert(data.responseText);
							$('city').replace('<select id="city" name="city" class="required-entry validate-select">' + '<option value="">Please Select City</option>' + data.responseText + '</select>');
						},
						onSuccess: function (data) {
							
						},
						onFailure: ''
					}
				);
			});
			</script>
          <input type="submit" value="Filter Now" name="filter" />
        </form>
        <script type="text/javascript">
        //	Handle form submit
        //< ![CDATA[
        var customForm = new VarienForm('filterFrm', true);
        //]]>
        </script>
      </div>
    </div>
  </div>
  <div class="main-content full-width">
    <div class="full-width mB10">
      <div class="row p0">
        <div class="left-content">
			<div class="full-width mB10">
			  <div class="heading full-width">Featured Schools, Colleges, Institutes and Universities</div>
        	<div class="content-box full-width mB10">
				<ul class="featured product-boxes" id="featured-box">
        <?php 
		if(($_products = Mage::helper('sarah')->getProductsFromCategory('18')) && $_products->getSize()){ 	
			foreach($_products->getItems() as $_product){
				//echo '<pre>';print_r($_product->getData());die;
				?>
                <li>
                    <div class="li-holder">
                        <div class="image-box full-width"><a rel="nofollow" href="<?php echo $_product->getProductUrl(); ?>"><img src="<?php echo $this->helper('catalog/image')->init($_product, 'small_image')->resize(450); ?>" class="img-responsive" alt="<?php echo $this->htmlEscape($_product->getName()) ?>" /></a></div>
                        <div class="detail-box full-width">
                            <div class="name"><?php echo $this->htmlEscape($_product->getName()) ?></div>
                            <div class="price-box"><?php echo $this->helper('core')->currency($_product->getPrice(),true,false) ?>
                            </div>
                            <?php /*?><a rel="nofollow" href="<?php echo $_product->getProductUrl(); ?>">
						<p class="fontsize-type1 low-margin-bottom"><?php echo  Mage::helper('core/string')->truncate($this->stripTags($_product->getShortDescription(), null, true), $length = 45, $etc = '...'); ?></p>
					</a><?php */?>
                        </div>
                    </div>
                </li>
        <?php }
		} ?>
				</ul>
				<script type="text/javascript">
				jQuery(document).ready(function(){
					jQuery('#featured-box').slick({
						arrows			: 	true,
						dots			: 	false,
						slidesToShow	: 	3,
						slidesToScroll	: 	1,
						autoplay: true,
						autoplaySpeed: 5000
					});
				});
				</script>
			  </div>
			</div>
        </div>
        <div class="right-content">
          <div class="heading full-width">News &amp; Announcements</div>
          <div class="content-box">
            <div class="full-width border-box-1px p10">
              <?php echo $this->getLayout()->createBlock('core/template')->setTemplate('aw_blog/latest.phtml')->toHtml(); ?>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="how-it-works full-width mB10 mT10">
      <div class="row p0"><img style="max-width: 100%;" alt="" src="{{skin url='images/how-it-works.jpg'}}" /></div>
    </div>
    
    <div class="full-width mT10">
      <div class="row p0">
        <div class="left-content">
        	<?php echo $this->getLayout()->createBlock('catalog/product_mostviewed')->setTemplate('catalog/product/mostviewed.phtml')->toHtml();?>
            <?php echo $this->getLayout()->createBlock('reports/product_viewed')->setTemplate('reports/product_viewed.phtml')->toHtml(); ?>
        </div>
        
        <div class="right-content">
          <?php echo $this->getLayout()->createBlock('testimonial/sidebar')->setTemplate('testimonial/sidebar/slider.phtml')->toHtml();?>
        </div>
        
      </div>
    </div>
  </div>
</div>
