<?php
$baseURL			=		Mage::getBaseUrl();
$skinURL			=		$this->getSkinUrl('images/');
?>
<script type="text/javascript">
//	Creating dynamic form action url
function OnSubmitForm(){
	var category	=	jQuery('#category').val();
	var categoryUrl = 	'schools.html';
	if(category==1){
		categoryUrl = 	'schools.html';
	}else if(category==2){
		categoryUrl = 	'coaching-institutes.html';
	}else if(category==3){
		categoryUrl = 	'colleges.html';
	}else if(category==4){
		categoryUrl = 	'universities.html';
	}
	var course		=	jQuery('#course').val();
	var state		=	jQuery('#state').val();
	var city		=	jQuery('#city').val();
	var url			= 	categoryUrl + '?course=' + course +'&state=' + state +'&city=' + city;
	//alert(url);
	jQuery("#filterFrm").attr("action");
	jQuery("#filterFrm").attr("action", '<?php echo Mage::getUrl()?>' + url);
	return true;
}
</script>

<div class="home">
  <div class="full-width">
    <div class="row p0">
      <div class="home-filter">
        <form name="filterFrm" id="filterFrm" method="post" onsubmit="return OnSubmitForm();">
            
            <select name="category" id="category" class="required-entry validate-select">
                <option value="">Browse by</option>
                <option value="1">School</option>
                <option value="2">Coaching</option>
                <option value="3">College</option>
                <option value="4">University</option>
            </select>
            
<script type="text/javascript">
Event.observe($('category'), 'change', function(event) {
	var action 		= 	"<?php echo $this->getUrl('querymanager/index/getCourses'); ?>";
	var categoryId 	= 	$('category').value;	
	var request 	= 	new Ajax.Request(action,
		{
			method: 'GET',
			parameters: {category_id: categoryId},
			onComplete: function(data) {
				//alert(data.responseText);
				$('course').replace('<select id="course" name="course" class="required-entry validate-select">' + '<option value="">Select a Course</option>' + data.responseText + '</select>');
			},
			onSuccess: function (data) {
				
			},
			onFailure: ''
		}
	);
});
</script>
            
            <?php	//	Showing courses
			$attribute 			= 	Mage::getModel('eav/config')->getAttribute('catalog_product', 'course');
			$courseCollection 	= 	$attribute->getSource()->getAllOptions(true, true);
			//echo '<pre>';print_r($courseCollection);die;
			if (count($courseCollection) > 0){ ?>
                <select name="course" id="course" class="required-entry validate-select">
                	<option value="">Select a Course</option>
                    <?php 
						foreach($courseCollection as $course){
							if($course['label']){ ?>
                        		<option value="<?php echo $course['value'];?>"><?php echo $course['label'] ?></option>
                    	<?php }
						} 
					?>
                </select>
            <?php }else{ ?>
                <input name="course" id="course" title="" value="" class="input-text required-entry"  placeholder="Course"/>
            <?php } ?>
            
            
			<?php	//	Showing states
			$attribute 	= 	Mage::getModel('eav/config')->getAttribute('catalog_product', 'state');
			$stateCollection = 	$attribute->getSource()->getAllOptions(true, true);
			//echo '<pre>';print_r($stateCollection);die;
			if (count($stateCollection) > 0){ ?>
                <select name="state" id="state" class="required-entry validate-select">
                	<option value="">Select a State</option>
                    <?php 
						foreach($stateCollection as $state){
							if($state['label']){ ?>
                        		<option value="<?php echo $state['value'];?>"><?php echo $state['label'] ?></option>
                    	<?php }
						} 
					?>
                </select>
            <?php }else{ ?>
                <input name="state" id="state" title="" value="" class="input-text required-entry"  placeholder="State"/>
            <?php } ?>
            
            <select name="city" id="city" class="required-entry validate-select">
              <option value="">Select a City </option>
            </select>
            
            <script type="text/javascript">
			Event.observe($('state'), 'change', function(event) {
				var action 	= 	"<?php echo $this->getUrl('querymanager/index/getCities'); ?>";
				var stateId = 	$('state').value;
				var request = 	new Ajax.Request(action,
					{
						method: 'GET',
						parameters: {state_id: stateId},
						onComplete: function(data) {
							//alert(data.responseText);
							$('city').replace('<select id="city" name="city" class="required-entry validate-select">' + '<option value="">Select a City</option>' + data.responseText + '</select>');
						},
						onSuccess: function (data) {
							
						},
						onFailure: ''
					}
				);
			});
			</script>
          <input type="submit" value="Filter Now" name="filter" />
        </form>
        <script type="text/javascript">
        //	Handle form submit
        //< ![CDATA[
        var customForm = new VarienForm('filterFrm', true);
        //]]>
        </script>
      </div>
    </div>
  </div>
  <div class="main-content full-width">
    <div class="full-width mB10">
      <div class="row p0">
        <div class="left-content">
			<div class="full-width mB10">
			  	<div class="heading full-width">Featured Schools, Colleges, Institutes and Universities</div>
        			<div class="content-box full-width mB10">
						<?php echo $this->getLayout()->createBlock('core/template')->setTemplate('homepage/featured.phtml')->toHtml(); ?>
					</div>
				</div>
        	</div>
        <div class="right-content">
          <div class="heading full-width">News &amp; Announcements</div>
          <div class="content-box">
            <div class="full-width border-box-1px p10">
              <?php echo $this->getLayout()->createBlock('core/template')->setTemplate('aw_blog/latest.phtml')->toHtml(); ?>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="how-it-works full-width mB10 mT10">
      <div class="row p0"><img style="max-width: 100%;" alt="" src="<?php echo $skinURL.'how-it-works.jpg';?>" /></div>
    </div>
    
    <div class="full-width mT10">
      <div class="row p0">
        <div class="left-content">
        	<?php echo $this->getLayout()->createBlock('catalog/product_mostviewed')->setTemplate('catalog/product/mostviewed.phtml')->toHtml();?>
            <?php echo $this->getLayout()->createBlock('reports/product_viewed')->setTemplate('reports/product_viewed_homepage.phtml')->toHtml(); ?>
        </div>
        
        <div class="right-content">
          <?php echo $this->getLayout()->createBlock('testimonial/sidebar')->setTemplate('testimonial/sidebar/slider.phtml')->toHtml();?>
        </div>
        
      </div>
    </div>
  </div>
</div>
